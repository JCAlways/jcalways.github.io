---
title: 搭建 Gitlab CE 服务器
date: 2025-09-04
updated:
tags:
categories:
keywords: gitlab
description: 使用宝塔面板 Docker 安装 Gitlab CE 服务器
cover: https://res.cloudinary.com/about-gitlab-com/image/upload/v1758208064/dzl0dbift9xdizyelkk4.svg
---

[官方文档](https://www.npmjs.com/package/nprogress)

# 安装

## 使用 宝塔面板 Docker 安装

![gitlab安装配置](https://s2.loli.net/2025/09/05/eBzhS35rQpbatUl.png)

## 完整docker-compose.yml

```yaml

services:
  gitlab:
    image: gitlab/gitlab-ce:${VERSION}
    #    container_name: ${CONTAINER_NAME}
    deploy:
      resources:
        limits:
          cpus: ${CPUS}
          memory: ${MEMORY_LIMIT}
    restart: always
    hostname: ${DOMAIN_HOST}
    shm_size: '256m'
    ports:
      - ${HOST_IP}:${WEB_HTTP_PORT}:80
      - ${HOST_IP}:${WEB_HTTPS_PORT}:443
      - ${HOST_IP}:${WEB_SSH_PORT}:22
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        # Add any other gitlab.rb configuration here, each on its own line
        external_url 'https://${DOMAIN_HOST}'
        nginx['listen_port'] = 80
        nginx['listen_https'] = false
        nginx['proxy_set_headers'] = { "X-Forwarded-Proto" => "https", "X-Forwarded-Ssl" => "on" }
        nginx['client_max_body_size'] = '0'
        nginx['proxy_read_timeout'] = 600
        nginx['proxy_connect_timeout'] = 600
        nginx['proxy_send_timeout'] = 600
        nginx['gzip_enabled'] = false
        gitlab_rails['smtp_enable'] = true
        gitlab_rails['smtp_address'] = "smtp.ym.163.com"
        gitlab_rails['smtp_port'] = 465
        gitlab_rails['smtp_user_name'] = "robot@domain.com"
        gitlab_rails['smtp_password'] = "PASSWORD"
        gitlab_rails['smtp_domain'] = "smtp.ym.163.com"
        gitlab_rails['smtp_authentication'] = "login"
        gitlab_rails['smtp_enable_starttls_auto'] = false
        gitlab_rails['smtp_tls'] = true
        gitlab_rails['gitlab_email_from'] = 'robot@domain.com'
    volumes:
      - ${APP_PATH}/config:/etc/gitlab
      - ${APP_PATH}/logs:/var/log/gitlab
      - ${APP_PATH}/data:/var/opt/gitlab
    labels:
      createdBy: "bt_apps"
    networks:
      - baota_net

networks:
  baota_net:
    external: true

```

## 完整.env

```
VERSION=latest
CONTAINER_NAME=CONTAINER_NAME
HOST_IP=127.0.0.1
WEB_HTTP_PORT=10080
WEB_HTTPS_PORT=10443
WEB_SSH_PORT=10022
DOMAIN_HOST=git.domain.com
CPUS=0
MEMORY_LIMIT=0MB
APP_PATH=/www/dk_project/dk_app/gitlab/gitlab
```

# 邮件服务配置

[官方文档](https://docs.gitlab.com/omnibus/settings/smtp/)

在docker-compose.yml 中GITLAB_OMNIBUS_CONFIG 修改

## 网易免费企业邮箱
```ruby
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.ym.163.com"
gitlab_rails['smtp_port'] = 465
gitlab_rails['smtp_user_name'] = "xxxx@xx.com"
gitlab_rails['smtp_password'] = "password"
gitlab_rails['smtp_authentication'] = "login"
gitlab_rails['smtp_enable_starttls_auto'] = false
gitlab_rails['smtp_tls'] = true
gitlab_rails['gitlab_email_from'] = 'xxxx@xx.com'
gitlab_rails['smtp_domain'] = "smtp.ym.163.com"
```

## 测试 SMTP 配置

您可以使用 Rails 控制台验证 GitLab 是否能够正常发送电子邮件。在 GitLab 服务器上，执行`gitlab-rails console`进入控制台。然后，您可以在控制台提示符下输入以下命令，让 GitLab 发送一封测试电子邮件：
```ruby
Notify.test_email('destination_email@address.com', 'Message Subject', 'Message Body').deliver_now
```